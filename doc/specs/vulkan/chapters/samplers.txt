// Copyright (c) 2015-2017 The Khronos Group Inc.
// Copyright notice at https://www.khronos.org/registry/speccopyright.html

[[samplers]]
= 采样器

// refBegin VkSampler Opaque handle to a sampler object

sname:VkSampler 对象代表着图像采样器的状态，图像采样器被Vulkan实现用来为着色器读取图像数据并进行过滤和其他变形操作。

采样器通过sname:VkSampler handle表示：

include::../api/handles/VkSampler.txt[]

// refEnd VkSampler

// refBegin vkCreateSampler Create a new sampler object

可调用如下命令来创建采样器对象：

include::../api/protos/vkCreateSampler.txt[]

  * pname:device 是创建采样器的逻辑设备。
  * pname:pCreateInfo 是一个指针，指向一个slink:VkSamplerCreateInfo 实例，指定了采样器对象的状态。
  * pname:pAllocator 控制CPU端内存分配，如<<memory-allocation, Memory Allocation>> 一章所讲解。
  * pname:pSampler 指向一个sname:VkSampler handle，接收返回的采样器对象。

include::../validity/protos/vkCreateSampler.txt[]

// refBegin VkSamplerCreateInfo Structure specifying parameters of a newly created sampler

sname:VkSamplerCreateInfo 类型数据结构定义如下：

include::../api/structs/VkSamplerCreateInfo.txt[]

  * pname:sType 是数据结构的类型。
  * pname:pNext 是 `NULL` 或者一个指向拓展特定的数据结构的指针。
  * pname:flags 被保留。
  * pname:magFilter is the magnification filter to apply to lookups, and is
    of type:
+
--
// refBegin VkFilter Specify filters used for texture lookups
include::../api/enums/VkFilter.txt[]
--
+
  * pname:minFilter 是应用到查找表的缩小过滤器，elink:VkFilter类型。
  * pname:mipmapMode 是应用到查找表的mipmap过滤器，在<<textures-texel-filtering, Texel Filtering>> 小节中有讲解，可选类型如下：
+
--
// refBegin VkSamplerMipmapMode Specify mipmap mode used for texture lookups
include::../api/enums/VkSamplerMipmapMode.txt[]
--
+
  * pname:addressModeU 是对于U坐标在[0..1] 之外的寻址方式。参考 elink:VkSamplerAddressMode
  * pname:addressModeV 是对于V坐标在[0..1] 之外的寻址方式。参考 elink:VkSamplerAddressMode。
  * pname:addressModeW 是对于V坐标在[0..1] 之外的寻址方式。参考 elink:VkSamplerAddressMode。
  * [[samplers-mipLodBias]] pname:mipLodBias is the bias to be added to
    mipmap LOD calculation and bias provided by image sampling functions in
    SPIR-V, as described in the <<textures-level-of-detail-operation,
    Level-of-Detail Operation>> section.
  * [[samplers-maxAnisotropy]] pname:anisotropyEnable is ename:VK_TRUE to
    enable anisotropic filtering, as described in the
    <<textures-texel-anisotropic-filtering, Texel Anisotropic Filtering>>
    section, or ename:VK_FALSE otherwise.
  * pname:maxAnisotropy is the anisotropy value clamp.
  * pname:compareEnable is ename:VK_TRUE to enable comparison against a
    reference value during lookups, or ename:VK_FALSE otherwise.
  ** Note: Some implementations will default to shader state if this member
     does not match.
  * pname:compareOp is the comparison function to apply to fetched data
    before filtering as described in the <<textures-depth-compare-operation,
    Depth Compare Operation>> section.
    See elink:VkCompareOp.
  * pname:minLod and pname:maxLod are the values used to clamp the computed
    level-of-detail value, as described in the
    <<textures-level-of-detail-operation, Level-of-Detail Operation>>
    section.
    pname:maxLod must: be greater than or equal to pname:minLod.
  * pname:borderColor 是将要使用的预定义的边界颜色，在<<textures-texel-replacement, Texel Replacement>> 一节讲解，可选类型如下：
+
--
// refBegin VkBorderColor Specify border color used for texture lookups
include::../api/enums/VkBorderColor.txt[]
--
+
  * [[samplers-unnormalizedCoordinates]] pname:unnormalizedCoordinates
    controls whether to use unnormalized or normalized texel coordinates to
    address texels of the image.
    When set to ename:VK_TRUE, the range of the image coordinates used to
    lookup the texel is in the range of zero to the image dimensions for x,
    y and z.
    When set to ename:VK_FALSE the range of image coordinates is zero to
    one.
    When pname:unnormalizedCoordinates is ename:VK_TRUE, samplers have the
    following requirements:
  ** pname:minFilter and pname:magFilter must: be equal.
  ** pname:mipmapMode must: be ename:VK_SAMPLER_MIPMAP_MODE_NEAREST.
  ** pname:minLod and pname:maxLod must: be zero.
  ** pname:addressModeU and pname:addressModeV must: each be either
     ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE or
     ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER.
  ** pname:anisotropyEnable must: be ename:VK_FALSE.
  ** pname:compareEnable must: be ename:VK_FALSE.
  * When pname:unnormalizedCoordinates is ename:VK_TRUE, images the sampler
    is used with in the shader have the following requirements:
  ** The pname:viewType must: be either ename:VK_IMAGE_VIEW_TYPE_1D or
     ename:VK_IMAGE_VIEW_TYPE_2D.
  ** The image view must: have a single layer and a single mip level.
  * When pname:unnormalizedCoordinates is ename:VK_TRUE, image built-in
    functions in the shader that use the sampler have the following
    requirements:
  ** The functions must: not use projection.
  ** The functions must: not use offsets.

[NOTE]
.把OpenGL的模式映射到Vulkan过滤模式
==================
pname:magFilter的值 ename:VK_FILTER_NEAREST 和 ename:VK_FILTER_LINEAR直接对应为 code:GL_NEAREST 和code:GL_LINEAR 放大过滤器。
pname:minFilter 和 pname:mipmapMode 联合起来对应着 OpenGL 缩小过滤器 code:GL_minFilter_MIPMAP_mipmapMode
(e.g. pname:minFilter of ename:VK_FILTER_LINEAR and pname:mipmapMode of
ename:VK_SAMPLER_MIPMAP_MODE_NEAREST correspond to
code:GL_LINEAR_MIPMAP_NEAREST).

There are no Vulkan filter modes that directly correspond to OpenGL
minification filters of code:GL_LINEAR or code:GL_NEAREST, but they can: be
emulated using ename:VK_SAMPLER_MIPMAP_MODE_NEAREST, pname:minLod = 0, and
pname:maxLod = 0.25, and using pname:minFilter = ename:VK_FILTER_LINEAR or
pname:minFilter = ename:VK_FILTER_NEAREST, respectively.

Note that using a pname:maxLod of zero would cause
<<textures-texel-filtering,magnification>> to always be performed, and the
pname:magFilter to always be used.
This is valid, just not an exact match for OpenGL behavior.
Clamping the maximum LOD to 0.25 allows the [eq]#{lambda}# value to be
non-zero and minification to be performed, while still always rounding down
to the base level.
If the pname:minFilter and pname:magFilter are equal, then using a
pname:maxLod of zero also works.
==================

pname:addressModeU, pname:addressModeV, 和 pname:addressModeW 任何一个必须是如下值：

// refBegin VkSamplerAddressMode Specify behavior of sampling with texture coordinates outside an image
include::../api/enums/VkSamplerAddressMode.txt[]

These values control the behavior of sampling with coordinates outside the
range [eq]#[0,1]# for the respective u, v, or w coordinate as defined in the
<<textures-wrapping-operation, Wrapping Operation>> section.

  * ename:VK_SAMPLER_ADDRESS_MODE_REPEAT 表明将使用重复铺排模式。
  * ename:VK_SAMPLER_ADDRESS_MODE_MIRRORED_REPEAT 表明将使用镜像重复铺排模式。
  * ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE 表明将使用边缘展开模式（clamp to edge）。
  * ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER 表明将使用边界展开模式( clamp to border）。
  * ename:VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE indicates that the
    mirror clamp to edge wrap mode will be used.
    This is only valid if the +VK_KHR_mirror_clamp_to_edge+ extension is
    enabled.

一个设备上可以同时创建的采样器个数最大值依赖于硬件设备，通过sname:VkPhysicalDeviceLimits数据结构的
<<features-limits-maxSamplerAllocationCount,pname:maxSamplerAllocationCount>>成员来指定。
若超过了pname:maxSamplerAllocationCount，fname:vkCreateSampler 将返回 ename:VK_ERROR_TOO_MANY_OBJECTS。

因为 sname:VkSampler 是一个不可分发handle类型，Vulkan实现可以为相同的采样器状态数组返回一个handle。
在这中情形下， 限制条件，所有的对象都将算作pname:maxSamplerAllocationCount限制的一个。

.正确使用
****
  * pname:mipLodBias 的绝对值必须小于等于 sname:VkPhysicalDeviceLimits::pname:maxSamplerLodBias
  * 若<<features-features-samplerAnisotropy,anisotropic sampling>> 特征没有被启用，pname:anisotropyEnable 必须是ename:VK_FALSE
  * 若pname:anisotropyEnable 为 ename:VK_TRUE，pname:maxAnisotropy 必须在`1.0` 和 name:VkPhysicalDeviceLimits::pname:maxSamplerAnisotropy之间，闭区间
  * 若 pname:unnormalizedCoordinates 为ename:VK_TRUE，pname:minFilter 和pname:magFilter 必须相等
  * 若 pname:unnormalizedCoordinates 为 ename:VK_TRUE，pname:mipmapMode必须为 ename:VK_SAMPLER_MIPMAP_MODE_NEAREST
  * 若 pname:unnormalizedCoordinates 为 ename:VK_TRUE，pname:minLod 和pname:maxLod 必须为0
  * 若 pname:unnormalizedCoordinates 为 ename:VK_TRUE，pname:addressModeU和pname:addressModeV 必须是ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_EDGE，
	或者ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER
  * 若 pname:unnormalizedCoordinates 为 ename:VK_TRUE，pname:anisotropyEnable 必须为ename:VK_FALSE
  * 若 pname:unnormalizedCoordinates 为 ename:VK_TRUE，pname:compareEnable必须为ename:VK_FALSE
  * 若 pname:addressModeU, pname:addressModeV 或 pname:addressModeW其中任何一个为ename:VK_SAMPLER_ADDRESS_MODE_CLAMP_TO_BORDER，
	pname:borderColor必须为一个有效的elink:VkBorderColor 值
  * 若 +VK_KHR_sampler_mirror_clamp_to_edge+ 拓展没有被启用，
    pname:addressModeU, pname:addressModeV 和 pname:addressModeW 不能为ename:VK_SAMPLER_ADDRESS_MODE_MIRROR_CLAMP_TO_EDGE
  * 若 pname:compareEnable 为 ename:VK_TRUE，pname:compareOp 必须是一个有效的elink:VkCompareOp 值
ifdef::VK_IMG_filter_cubic[]
  * If either pname:magFilter or pname:minFilter is
    ename:VK_FILTER_CUBIC_IMG, pname:anisotropyEnable must: be
    ename:VK_FALSE
endif::VK_IMG_filter_cubic[]
****

include::../validity/structs/VkSamplerCreateInfo.txt[]

// refBegin vkDestroySampler Destroy a sampler object

可调用如下命令来销毁一个采样器：

include::../api/protos/vkDestroySampler.txt[]

  * pname:device 是销毁采样器的逻辑设备。
  * pname:sampler 是需要被销毁的采样器。
  * pname:pAllocator 控制CPU端内存分配，如<<memory-allocation, Memory Allocation>> 一章所讲解。

.正确使用
****
  * 所有引用到pname:sampler的被提交的命令必须已经完成了。
  * 若创建pname:sampler 时提供了sname:VkAllocationCallbacks，那么就必须提供兼容的回调函数。
  * 若创建pname:sampler 时没有提供sname:VkAllocationCallbacks，pname:pAllocator 必须为`NULL`
****

include::../validity/protos/vkDestroySampler.txt[]
